var __decorate = (this && this.__decorate) || function (decorators, target, key, desc) {
    var c = arguments.length, r = c < 3 ? target : desc === null ? desc = Object.getOwnPropertyDescriptor(target, key) : desc, d;
    if (typeof Reflect === "object" && typeof Reflect.decorate === "function") r = Reflect.decorate(decorators, target, key, desc);
    else for (var i = decorators.length - 1; i >= 0; i--) if (d = decorators[i]) r = (c < 3 ? d(r) : c > 3 ? d(target, key, r) : d(target, key)) || r;
    return c > 3 && r && Object.defineProperty(target, key, r), r;
};
var __metadata = (this && this.__metadata) || function (k, v) {
    if (typeof Reflect === "object" && typeof Reflect.metadata === "function") return Reflect.metadata(k, v);
};
var __param = (this && this.__param) || function (paramIndex, decorator) {
    return function (target, key) { decorator(target, key, paramIndex); }
};
import { Inject, Injectable } from 'angular2/src/core/di';
import { isPresent, isBlank } from 'angular2/src/facade/lang';
import { ListWrapper, StringMapWrapper } from 'angular2/src/facade/collection';
import { BaseException } from 'angular2/src/facade/exceptions';
import { flattenNestedViewRenderNodes } from './view';
import { AppElement } from './element';
import { AppViewListener } from './view_listener';
import { RootRenderer, RenderComponentType } from 'angular2/src/core/render/api';
import { wtfCreateScope, wtfLeave } from '../profile/profile';
import { APP_ID } from 'angular2/src/core/application_tokens';
import { ViewType } from './view_type';
/**
 * Service exposing low level API for creating, moving and destroying Views.
 *
 * Most applications should use higher-level abstractions like {@link DynamicComponentLoader} and
 * {@link ViewContainerRef} instead.
 */
export class AppViewManager {
}
export let AppViewManager_ = class extends AppViewManager {
    constructor(_renderer, _viewListener, _appId) {
        super();
        this._renderer = _renderer;
        this._viewListener = _viewListener;
        this._appId = _appId;
        this._nextCompTypeId = 0;
        /** @internal */
        this._createRootHostViewScope = wtfCreateScope('AppViewManager#createRootHostView()');
        /** @internal */
        this._destroyRootHostViewScope = wtfCreateScope('AppViewManager#destroyRootHostView()');
        /** @internal */
        this._createEmbeddedViewInContainerScope = wtfCreateScope('AppViewManager#createEmbeddedViewInContainer()');
        /** @internal */
        this._createHostViewInContainerScope = wtfCreateScope('AppViewManager#createHostViewInContainer()');
        /** @internal */
        this._destroyViewInContainerScope = wtfCreateScope('AppViewMananger#destroyViewInContainer()');
        /** @internal */
        this._attachViewInContainerScope = wtfCreateScope('AppViewMananger#attachViewInContainer()');
        /** @internal */
        this._detachViewInContainerScope = wtfCreateScope('AppViewMananger#detachViewInContainer()');
    }
    getViewContainer(location) {
        return location.internalElement.getViewContainerRef();
    }
    getHostElement(hostViewRef) {
        var hostView = hostViewRef.internalView;
        if (hostView.proto.type !== ViewType.HOST) {
            throw new BaseException('This operation is only allowed on host views');
        }
        return hostView.appElements[0].ref;
    }
    getNamedElementInComponentView(hostLocation, variableName) {
        var appEl = hostLocation.internalElement;
        var componentView = appEl.componentView;
        if (isBlank(componentView)) {
            throw new BaseException(`There is no component directive at element ${hostLocation}`);
        }
        for (var i = 0; i < componentView.appElements.length; i++) {
            var compAppEl = componentView.appElements[i];
            if (StringMapWrapper.contains(compAppEl.proto.directiveVariableBindings, variableName)) {
                return compAppEl.ref;
            }
        }
        throw new BaseException(`Could not find variable ${variableName}`);
    }
    getComponent(hostLocation) {
        return hostLocation.internalElement.getComponent();
    }
    createRootHostView(hostViewFactoryRef, overrideSelector, injector, projectableNodes = null) {
        var s = this._createRootHostViewScope();
        var hostViewFactory = hostViewFactoryRef.internalHostViewFactory;
        var selector = isPresent(overrideSelector) ? overrideSelector : hostViewFactory.selector;
        var view = hostViewFactory.viewFactory(this._renderer, this, null, projectableNodes, selector, null, injector);
        return wtfLeave(s, view.ref);
    }
    destroyRootHostView(hostViewRef) {
        var s = this._destroyRootHostViewScope();
        var hostView = hostViewRef.internalView;
        hostView.renderer.detachView(flattenNestedViewRenderNodes(hostView.rootNodesOrAppElements));
        hostView.destroy();
        wtfLeave(s);
    }
    createEmbeddedViewInContainer(viewContainerLocation, index, templateRef) {
        var s = this._createEmbeddedViewInContainerScope();
        var contextEl = templateRef.elementRef.internalElement;
        var view = contextEl.embeddedViewFactory(contextEl.parentView.renderer, this, contextEl, contextEl.parentView.projectableNodes, null, null, null);
        this._attachViewToContainer(view, viewContainerLocation.internalElement, index);
        return wtfLeave(s, view.ref);
    }
    createHostViewInContainer(viewContainerLocation, index, hostViewFactoryRef, dynamicallyCreatedProviders, projectableNodes) {
        var s = this._createHostViewInContainerScope();
        // TODO(tbosch): This should be specifiable via an additional argument!
        var contextEl = viewContainerLocation.internalElement;
        var hostViewFactory = hostViewFactoryRef.internalHostViewFactory;
        var view = hostViewFactory.viewFactory(contextEl.parentView.renderer, contextEl.parentView.viewManager, contextEl, projectableNodes, null, dynamicallyCreatedProviders, null);
        this._attachViewToContainer(view, viewContainerLocation.internalElement, index);
        return wtfLeave(s, view.ref);
    }
    destroyViewInContainer(viewContainerLocation, index) {
        var s = this._destroyViewInContainerScope();
        var view = this._detachViewInContainer(viewContainerLocation.internalElement, index);
        view.destroy();
        wtfLeave(s);
    }
    // TODO(i): refactor detachViewInContainer+attachViewInContainer to moveViewInContainer
    attachViewInContainer(viewContainerLocation, index, viewRef) {
        var s = this._attachViewInContainerScope();
        this._attachViewToContainer(viewRef.internalView, viewContainerLocation.internalElement, index);
        return wtfLeave(s, viewRef);
    }
    // TODO(i): refactor detachViewInContainer+attachViewInContainer to moveViewInContainer
    detachViewInContainer(viewContainerLocation, index) {
        var s = this._detachViewInContainerScope();
        var view = this._detachViewInContainer(viewContainerLocation.internalElement, index);
        return wtfLeave(s, view.ref);
    }
    /** @internal */
    onViewCreated(view) { this._viewListener.onViewCreated(view); }
    /** @internal */
    onViewDestroyed(view) { this._viewListener.onViewDestroyed(view); }
    /** @internal */
    createRenderComponentType(encapsulation, styles) {
        return new RenderComponentType(`${this._appId}-${this._nextCompTypeId++}`, encapsulation, styles);
    }
    _attachViewToContainer(view, vcAppElement, viewIndex) {
        if (view.proto.type === ViewType.COMPONENT) {
            throw new BaseException(`Component views can't be moved!`);
        }
        var nestedViews = vcAppElement.nestedViews;
        if (nestedViews == null) {
            nestedViews = [];
            vcAppElement.nestedViews = nestedViews;
        }
        ListWrapper.insert(nestedViews, viewIndex, view);
        var refNode;
        if (viewIndex > 0) {
            var prevView = nestedViews[viewIndex - 1];
            refNode = prevView.rootNodesOrAppElements.length > 0 ?
                prevView.rootNodesOrAppElements[prevView.rootNodesOrAppElements.length - 1] :
                null;
        }
        else {
            refNode = vcAppElement.nativeElement;
        }
        if (isPresent(refNode)) {
            var refRenderNode;
            if (refNode instanceof AppElement) {
                refRenderNode = refNode.nativeElement;
            }
            else {
                refRenderNode = refNode;
            }
            view.renderer.attachViewAfter(refRenderNode, flattenNestedViewRenderNodes(view.rootNodesOrAppElements));
        }
        // TODO: This is only needed when a view is destroyed,
        // not when it is detached for reordering with ng-for...
        vcAppElement.parentView.changeDetector.addContentChild(view.changeDetector);
        vcAppElement.traverseAndSetQueriesAsDirty();
    }
    _detachViewInContainer(vcAppElement, viewIndex) {
        var view = ListWrapper.removeAt(vcAppElement.nestedViews, viewIndex);
        if (view.proto.type === ViewType.COMPONENT) {
            throw new BaseException(`Component views can't be moved!`);
        }
        vcAppElement.traverseAndSetQueriesAsDirty();
        view.renderer.detachView(flattenNestedViewRenderNodes(view.rootNodesOrAppElements));
        // TODO: This is only needed when a view is destroyed,
        // not when it is detached for reordering with ng-for...
        view.changeDetector.remove();
        return view;
    }
};
AppViewManager_ = __decorate([
    Injectable(),
    __param(2, Inject(APP_ID)), 
    __metadata('design:paramtypes', [RootRenderer, AppViewListener, String])
], AppViewManager_);
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoidmlld19tYW5hZ2VyLmpzIiwic291cmNlUm9vdCI6IiIsInNvdXJjZXMiOlsiYW5ndWxhcjIvc3JjL2NvcmUvbGlua2VyL3ZpZXdfbWFuYWdlci50cyJdLCJuYW1lcyI6WyJBcHBWaWV3TWFuYWdlciIsIkFwcFZpZXdNYW5hZ2VyXyIsIkFwcFZpZXdNYW5hZ2VyXy5jb25zdHJ1Y3RvciIsIkFwcFZpZXdNYW5hZ2VyXy5nZXRWaWV3Q29udGFpbmVyIiwiQXBwVmlld01hbmFnZXJfLmdldEhvc3RFbGVtZW50IiwiQXBwVmlld01hbmFnZXJfLmdldE5hbWVkRWxlbWVudEluQ29tcG9uZW50VmlldyIsIkFwcFZpZXdNYW5hZ2VyXy5nZXRDb21wb25lbnQiLCJBcHBWaWV3TWFuYWdlcl8uY3JlYXRlUm9vdEhvc3RWaWV3IiwiQXBwVmlld01hbmFnZXJfLmRlc3Ryb3lSb290SG9zdFZpZXciLCJBcHBWaWV3TWFuYWdlcl8uY3JlYXRlRW1iZWRkZWRWaWV3SW5Db250YWluZXIiLCJBcHBWaWV3TWFuYWdlcl8uY3JlYXRlSG9zdFZpZXdJbkNvbnRhaW5lciIsIkFwcFZpZXdNYW5hZ2VyXy5kZXN0cm95Vmlld0luQ29udGFpbmVyIiwiQXBwVmlld01hbmFnZXJfLmF0dGFjaFZpZXdJbkNvbnRhaW5lciIsIkFwcFZpZXdNYW5hZ2VyXy5kZXRhY2hWaWV3SW5Db250YWluZXIiLCJBcHBWaWV3TWFuYWdlcl8ub25WaWV3Q3JlYXRlZCIsIkFwcFZpZXdNYW5hZ2VyXy5vblZpZXdEZXN0cm95ZWQiLCJBcHBWaWV3TWFuYWdlcl8uY3JlYXRlUmVuZGVyQ29tcG9uZW50VHlwZSIsIkFwcFZpZXdNYW5hZ2VyXy5fYXR0YWNoVmlld1RvQ29udGFpbmVyIiwiQXBwVmlld01hbmFnZXJfLl9kZXRhY2hWaWV3SW5Db250YWluZXIiXSwibWFwcGluZ3MiOiI7Ozs7Ozs7Ozs7OztPQUFPLEVBRUwsTUFBTSxFQUVOLFVBQVUsRUFHWCxNQUFNLHNCQUFzQjtPQUN0QixFQUFDLFNBQVMsRUFBRSxP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QUFDQSxZQUFZQSxDQUFDQSxXQUFXQSxFQUFFQSxTQUFTQSxDQUFDQSxDQUFDQTtRQUNyRUEsRUFBRUEsQ0FBQ0EsQ0FBQ0EsSUFBSUEsQ0FBQ0EsS0FBS0EsQ0FBQ0EsSUFBSUEsS0FBS0EsUUFBUUEsQ0FBQ0EsU0FBU0EsQ0FBQ0EsQ0FBQ0EsQ0FBQ0E7WUFDM0NBLE1BQU1BLElBQUlBLGFBQWFBLENBQUNBLGlDQUFpQ0EsQ0FBQ0EsQ0FBQ0E7UUFDN0RBLENBQUNBO1FBQ0RBLFlBQVlBLENBQUNBLDRCQUE0QkEsRUFBRUEsQ0FBQ0E7UUFFNUNBLElBQUlBLENBQUNBLFFBQVFBLENBQUNBLFVBQVVBLENBQUNBLDRCQUE0QkEsQ0FBQ0EsSUFBSUEsQ0FBQ0Esc0JBQXNCQSxDQUFDQSxDQUFDQSxDQUFDQTtRQUVwRkEsc0RBQXNEQTtRQUN0REEsd0RBQXdEQTtRQUN4REEsSUFBSUEsQ0FBQ0EsY0FBY0EsQ0FBQ0EsTUFBTUEsRUFBRUEsQ0FBQ0E7UUFDN0JBLE1BQU1BLENBQUNBLElBQUlBLENBQUNBO0lBQ2RBLENBQUNBO0FBQ0hqQixDQUFDQTtBQS9MRDtJQUFDLFVBQVUsRUFBRTtJQUtDLFdBQUMsTUFBTSxDQUFDLE1BQU0sQ0FBQyxDQUFBOztvQkEwTDVCO0FBQUEiLCJzb3VyY2VzQ29udGVudCI6WyJpbXBvcnQge1xuICBJbmplY3RvcixcbiAgSW5qZWN0LFxuICBQcm92aWRlcixcbiAgSW5qZWN0YWJsZSxcbiAgUmVzb2x2ZWRQcm92aWRlcixcbiAgZm9yd2FyZFJlZlxufSBmcm9tICdhbmd1bGFyMi9zcmMvY29yZS9kaSc7XG5pbXBvcnQge2lzUHJlc2VudCwgaXNCbGFuaywgaXNBcnJheX0gZnJvbSAnYW5ndWxhcjIvc3JjL2ZhY2FkZS9sYW5nJztcbmltcG9ydCB7TGlzdFdyYXBwZXIsIFN0cmluZ01hcFdyYXBwZXJ9IGZyb20gJ2FuZ3VsYXIyL3NyYy9mYWNhZGUvY29sbGVjdGlvbic7XG5pbXBvcnQge0Jhc2VFeGNlcHRpb259IGZyb20gJ2FuZ3VsYXIyL3NyYy9mYWNhZGUvZXhjZXB0aW9ucyc7XG5pbXBvcnQge0FwcFZpZXcsIEhvc3RWaWV3RmFjdG9yeSwgZmxhdHRlbk5lc3RlZFZpZXdSZW5kZXJOb2Rlc30gZnJvbSAnLi92aWV3JztcbmltcG9ydCB7QXBwRWxlbWVudH0gZnJvbSAnLi9lbGVtZW50JztcbmltcG9ydCB7RWxlbWVudFJlZiwgRWxlbWVudFJlZl99IGZyb20gJy4vZWxlbWVudF9yZWYnO1xuaW1wb3J0IHtcbiAgSG9zdFZpZXdGYWN0b3J5UmVmLFxuICBIb3N0Vmlld0ZhY3RvcnlSZWZfLFxuICBFbWJlZGRlZFZpZXdSZWYsXG4gIEhvc3RWaWV3UmVmLFxuICBWaWV3UmVmX1xufSBmcm9tICcuL3ZpZXdfcmVmJztcbmltcG9ydCB7Vmlld0NvbnRhaW5lclJlZn0gZnJvbSAnLi92aWV3X2NvbnRhaW5lcl9yZWYnO1xuaW1wb3J0IHtUZW1wbGF0ZVJlZiwgVGVtcGxhdGVSZWZffSBmcm9tICcuL3RlbXBsYXRlX3JlZic7XG5pbXBvcnQge0FwcFZpZXdMaXN0ZW5lcn0gZnJvbSAnLi92aWV3X2xpc3RlbmVyJztcbmltcG9ydCB7Um9vdFJlbmRlcmVyLCBSZW5kZXJDb21wb25lbnRUeXBlfSBmcm9tICdhbmd1bGFyMi9zcmMvY29yZS9yZW5kZXIvYXBpJztcbmltcG9ydCB7d3RmQ3JlYXRlU2NvcGUsIHd0ZkxlYXZlLCBXdGZTY29wZUZufSBmcm9tICcuLi9wcm9maWxlL3Byb2ZpbGUnO1xuaW1wb3J0IHtBUFBfSUR9IGZyb20gJ2FuZ3VsYXIyL3NyYy9jb3JlL2FwcGxpY2F0aW9uX3Rva2Vucyc7XG5pbXBvcnQge1ZpZXdFbmNhcHN1bGF0aW9ufSBmcm9tICdhbmd1bGFyMi9zcmMvY29yZS9tZXRhZGF0YS92aWV3JztcbmltcG9ydCB7Vmlld1R5cGV9IGZyb20gJy4vdmlld190eXBlJztcblxuLyoqXG4gKiBTZXJ2aWNlIGV4cG9zaW5nIGxvdyBsZXZlbCBBUEkgZm9yIGNyZWF0aW5nLCBtb3ZpbmcgYW5kIGRlc3Ryb3lpbmcgVmlld3MuXG4gKlxuICogTW9zdCBhcHBsaWNhdGlvbnMgc2hvdWxkIHVzZSBoaWdoZXItbGV2ZWwgYWJzdHJhY3Rpb25zIGxpa2Uge0BsaW5rIER5bmFtaWNDb21wb25lbnRMb2FkZXJ9IGFuZFxuICoge0BsaW5rIFZpZXdDb250YWluZXJSZWZ9IGluc3RlYWQuXG4gKi9cbmV4cG9ydCBhYnN0cmFjdCBjbGFzcyBBcHBWaWV3TWFuYWdlciB7XG4gIC8qKlxuICAgKiBSZXR1cm5zIGEge0BsaW5rIFZpZXdDb250YWluZXJSZWZ9IG9mIHRoZSBWaWV3IENvbnRhaW5lciBhdCB0aGUgc3BlY2lmaWVkIGxvY2F0aW9uLlxuICAgKi9cbiAgYWJzdHJhY3QgZ2V0Vmlld0NvbnRhaW5lcihsb2NhdGlvbjogRWxlbWVudFJlZik6IFZpZXdDb250YWluZXJSZWY7XG5cbiAgLyoqXG4gICAqIFJldHVybnMgdGhlIHtAbGluayBFbGVtZW50UmVmfSB0aGF0IG1ha2VzIHVwIHRoZSBzcGVjaWZpZWQgSG9zdCBWaWV3LlxuICAgKi9cbiAgYWJzdHJhY3QgZ2V0SG9zdEVsZW1lbnQoaG9zdFZpZXdSZWY6IEhvc3RWaWV3UmVmKTogRWxlbWVudFJlZjtcblxuICAvKipcbiAgICogU2VhcmNoZXMgdGhlIENvbXBvbmVudCBWaWV3IG9mIHRoZSBDb21wb25lbnQgc3BlY2lmaWVkIHZpYSBgaG9zdExvY2F0aW9uYCBhbmQgcmV0dXJucyB0aGVcbiAgICoge0BsaW5rIEVsZW1lbnRSZWZ9IGZvciB0aGUgRWxlbWVudCBpZGVudGlmaWVkIHZpYSBhIFZhcmlhYmxlIE5hbWUgYHZhcmlhYmxlTmFtZWAuXG4gICAqXG4gICAqIFRocm93cyBhbiBleGNlcHRpb24gaWYgdGhlIHNwZWNpZmllZCBgaG9zdExvY2F0aW9uYCBpcyBub3QgYSBIb3N0IEVsZW1lbnQgb2YgYSBDb21wb25lbnQsIG9yIGlmXG4gICAqIHZhcmlhYmxlIGB2YXJpYWJsZU5hbWVgIGNvdWxkbid0IGJlIGZvdW5kIGluIHRoZSBDb21wb25lbnQgVmlldyBvZiB0aGlzIENvbXBvbmVudC5cbiAgICovXG4gIGFic3RyYWN0IGdldE5hbWVkRWxlbWVudEluQ29tcG9uZW50Vmlldyhob3N0TG9jYXRpb246IEVsZW1lbnRSZWYsXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB2YXJpYWJsZU5hbWU6IHN0cmluZyk6IEVsZW1lbnRSZWY7XG5cbiAgLyoqXG4gICAqIFJldHVybnMgdGhlIGNvbXBvbmVudCBpbnN0YW5jZSBmb3IgdGhlIHByb3ZpZGVkIEhvc3QgRWxlbWVudC5cbiAgICovXG4gIGFic3RyYWN0IGdldENvbXBvbmVudChob3N0TG9jYXRpb246IEVsZW1lbnRSZWYpOiBhbnk7XG5cbiAgLyoqXG4gICAqIENyZWF0ZXMgYW4gaW5zdGFuY2Ugb2YgYSBDb21wb25lbnQgYW5kIGF0dGFjaGVzIGl0IHRvIHRoZSBmaXJzdCBlbGVtZW50IGluIHRoZSBnbG9iYWwgVmlld1xuICAgKiAodXN1YWxseSBET00gRG9jdW1lbnQpIHRoYXQgbWF0Y2hlcyB0aGUgY29tcG9uZW50J3Mgc2VsZWN0b3Igb3IgYG92ZXJyaWRlU2VsZWN0b3JgLlxuICAgKlxuICAgKiBUaGlzIGFzIGEgbG93LWxldmVsIHdheSB0byBib290c3RyYXAgYW4gYXBwbGljYXRpb24gYW5kIHVwZ3JhZGUgYW4gZXhpc3RpbmcgRWxlbWVudCB0byBhXG4gICAqIEhvc3QgRWxlbWVudC4gTW9zdCBhcHBsaWNhdGlvbnMgc2hvdWxkIHVzZSB7QGxpbmsgRHluYW1pY0NvbXBvbmVudExvYWRlciNsb2FkQXNSb290fSBpbnN0ZWFkLlxuICAgKlxuICAgKiBUaGUgQ29tcG9uZW50IGFuZCBpdHMgVmlldyBhcmUgY3JlYXRlZCBiYXNlZCBvbiB0aGUgYGhvc3RQcm90b0NvbXBvbmVudFJlZmAgd2hpY2ggY2FuIGJlXG4gICAqIG9idGFpbmVkXG4gICAqIGJ5IGNvbXBpbGluZyB0aGUgY29tcG9uZW50IHdpdGgge0BsaW5rIENvbXBpbGVyI2NvbXBpbGVJbkhvc3R9LlxuICAgKlxuICAgKiBVc2Uge0BsaW5rIEFwcFZpZXdNYW5hZ2VyI2Rlc3Ryb3lSb290SG9zdFZpZXd9IHRvIGRlc3Ryb3kgdGhlIGNyZWF0ZWQgQ29tcG9uZW50IGFuZCBpdCdzIEhvc3RcbiAgICogVmlldy5cbiAgICpcbiAgICogIyMjIEV4YW1wbGVcbiAgICpcbiAgICogYGBgXG4gICAqIEBuZy5Db21wb25lbnQoe1xuICAgKiAgIHNlbGVjdG9yOiAnY2hpbGQtY29tcG9uZW50J1xuICAgKiB9KVxuICAgKiBAbmcuVmlldyh7XG4gICAqICAgdGVtcGxhdGU6ICdDaGlsZCdcbiAgICogfSlcbiAgICogY2xhc3MgQ2hpbGRDb21wb25lbnQge1xuICAgKlxuICAgKiB9XG4gICAqXG4gICAqIEBuZy5Db21wb25lbnQoe1xuICAgKiAgIHNlbGVjdG9yOiAnbXktYXBwJ1xuICAgKiB9KVxuICAgKiBAbmcuVmlldyh7XG4gICAqICAgdGVtcGxhdGU6IGBcbiAgICogICAgIFBhcmVudCAoPHNvbWUtY29tcG9uZW50Pjwvc29tZS1jb21wb25lbnQ+KVxuICAgKiAgIGBcbiAgICogfSlcbiAgICogY2xhc3MgTXlBcHAgaW1wbGVtZW50cyBPbkRlc3Ryb3kge1xuICAgKiAgIHZpZXdSZWY6IG5nLlZpZXdSZWY7XG4gICAqXG4gICAqICAgY29uc3RydWN0b3IocHVibGljIGFwcFZpZXdNYW5hZ2VyOiBuZy5BcHBWaWV3TWFuYWdlciwgY29tcGlsZXI6IG5nLkNvbXBpbGVyKSB7XG4gICAqICAgICBjb21waWxlci5jb21waWxlSW5Ib3N0KENoaWxkQ29tcG9uZW50KS50aGVuKChwcm90b1ZpZXc6IG5nLlByb3RvQ29tcG9uZW50UmVmKSA9PiB7XG4gICAqICAgICAgIHRoaXMudmlld1JlZiA9IGFwcFZpZXdNYW5hZ2VyLmNyZWF0ZVJvb3RIb3N0Vmlldyhwcm90b1ZpZXcsICdzb21lLWNvbXBvbmVudCcsIG51bGwpO1xuICAgKiAgICAgfSlcbiAgICogICB9XG4gICAqXG4gICAqICAgbmdPbkRlc3Ryb3koKSB7XG4gICAqICAgICB0aGlzLmFwcFZpZXdNYW5hZ2VyLmRlc3Ryb3lSb290SG9zdFZpZXcodGhpcy52aWV3UmVmKTtcbiAgICogICAgIHRoaXMudmlld1JlZiA9IG51bGw7XG4gICAqICAgfVxuICAgKiB9XG4gICAqXG4gICAqIG5nLmJvb3RzdHJhcChNeUFwcCk7XG4gICAqIGBgYFxuICAgKi9cbiAgYWJzdHJhY3QgY3JlYXRlUm9vdEhvc3RWaWV3KGhvc3RWaWV3RmFjdG9yeVJlZjogSG9zdFZpZXdGYWN0b3J5UmVmLCBvdmVycmlkZVNlbGVjdG9yOiBzdHJpbmcsXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICBpbmplY3RvcjogSW5qZWN0b3IsIHByb2plY3RhYmxlTm9kZXM/OiBhbnlbXVtdKTogSG9zdFZpZXdSZWY7XG5cbiAgLyoqXG4gICAqIERlc3Ryb3lzIHRoZSBIb3N0IFZpZXcgY3JlYXRlZCB2aWEge0BsaW5rIEFwcFZpZXdNYW5hZ2VyI2NyZWF0ZVJvb3RIb3N0Vmlld30uXG4gICAqXG4gICAqIEFsb25nIHdpdGggdGhlIEhvc3QgVmlldywgdGhlIENvbXBvbmVudCBJbnN0YW5jZSBhcyB3ZWxsIGFzIGFsbCBuZXN0ZWQgVmlldyBhbmQgQ29tcG9uZW50cyBhcmVcbiAgICogZGVzdHJveWVkIGFzIHdlbGwuXG4gICAqL1xuICBhYnN0cmFjdCBkZXN0cm95Um9vdEhvc3RWaWV3KGhvc3RWaWV3UmVmOiBIb3N0Vmlld1JlZik7XG5cbiAgLyoqXG4gICAqIEluc3RhbnRpYXRlcyBhbiBFbWJlZGRlZCBWaWV3IGJhc2VkIG9uIHRoZSB7QGxpbmsgVGVtcGxhdGVSZWYgYHRlbXBsYXRlUmVmYH0gYW5kIGluc2VydHMgaXRcbiAgICogaW50byB0aGUgVmlldyBDb250YWluZXIgc3BlY2lmaWVkIHZpYSBgdmlld0NvbnRhaW5lckxvY2F0aW9uYCBhdCB0aGUgc3BlY2lmaWVkIGBpbmRleGAuXG4gICAqXG4gICAqIFJldHVybnMgdGhlIHtAbGluayBWaWV3UmVmfSBmb3IgdGhlIG5ld2x5IGNyZWF0ZWQgVmlldy5cbiAgICpcbiAgICogVGhpcyBhcyBhIGxvdy1sZXZlbCB3YXkgdG8gY3JlYXRlIGFuZCBhdHRhY2ggYW4gRW1iZWRkZWQgdmlhIHRvIGEgVmlldyBDb250YWluZXIuIE1vc3RcbiAgICogYXBwbGljYXRpb25zIHNob3VsZCB1c2VkIHtAbGluayBWaWV3Q29udGFpbmVyUmVmI2NyZWF0ZUVtYmVkZGVkVmlld30gaW5zdGVhZC5cbiAgICpcbiAgICogVXNlIHtAbGluayBBcHBWaWV3TWFuYWdlciNkZXN0cm95Vmlld0luQ29udGFpbmVyfSB0byBkZXN0cm95IHRoZSBjcmVhdGVkIEVtYmVkZGVkIFZpZXcuXG4gICAqL1xuICAvLyBUT0RPKGkpOiB0aGlzIGxvdy1sZXZlbCB2ZXJzaW9uIG9mIFZpZXdDb250YWluZXJSZWYjY3JlYXRlRW1iZWRkZWRWaWV3IGRvZXNuJ3QgYWRkIGFueXRoaW5nIG5ld1xuICAvLyAgICB3ZSBzaG91bGQgbWFrZSBpdCBwcml2YXRlLCBvdGhlcndpc2Ugd2UgaGF2ZSB0d28gYXBpcyB0byBkbyB0aGUgc2FtZSB0aGluZy5cbiAgYWJzdHJhY3QgY3JlYXRlRW1iZWRkZWRWaWV3SW5Db250YWluZXIodmlld0NvbnRhaW5lckxvY2F0aW9uOiBFbGVtZW50UmVmLCBpbmRleDogbnVtYmVyLFxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB0ZW1wbGF0ZVJlZjogVGVtcGxhdGVSZWYpOiBFbWJlZGRlZFZpZXdSZWY7XG5cbiAgLyoqXG4gICAqIEluc3RhbnRpYXRlcyBhIHNpbmdsZSB7QGxpbmsgQ29tcG9uZW50fSBhbmQgaW5zZXJ0cyBpdHMgSG9zdCBWaWV3IGludG8gdGhlIFZpZXcgQ29udGFpbmVyXG4gICAqIGZvdW5kIGF0IGB2aWV3Q29udGFpbmVyTG9jYXRpb25gLiBXaXRoaW4gdGhlIGNvbnRhaW5lciwgdGhlIHZpZXcgd2lsbCBiZSBpbnNlcnRlZCBhdCBwb3NpdGlvblxuICAgKiBzcGVjaWZpZWQgdmlhIGBpbmRleGAuXG4gICAqXG4gICAqIFRoZSBjb21wb25lbnQgaXMgaW5zdGFudGlhdGVkIHVzaW5nIGl0cyB7QGxpbmsgUHJvdG9WaWV3UmVmIGBwcm90b1ZpZXdSZWZgfSB3aGljaCBjYW4gYmVcbiAgICogb2J0YWluZWQgdmlhIHtAbGluayBDb21waWxlciNjb21waWxlSW5Ib3N0fS5cbiAgICpcbiAgICogWW91IGNhbiBvcHRpb25hbGx5IHNwZWNpZnkgYGR5bmFtaWNhbGx5Q3JlYXRlZFByb3ZpZGVyc2AsIHdoaWNoIGNvbmZpZ3VyZSB0aGUge0BsaW5rIEluamVjdG9yfVxuICAgKiB0aGF0IHdpbGwgYmUgY3JlYXRlZCBmb3IgdGhlIEhvc3QgVmlldy5cbiAgICpcbiAgICogUmV0dXJucyB0aGUge0BsaW5rIEhvc3RWaWV3UmVmfSBvZiB0aGUgSG9zdCBWaWV3IGNyZWF0ZWQgZm9yIHRoZSBuZXdseSBpbnN0YW50aWF0ZWQgQ29tcG9uZW50LlxuICAgKlxuICAgKiBVc2Uge0BsaW5rIEFwcFZpZXdNYW5hZ2VyI2Rlc3Ryb3lWaWV3SW5Db250YWluZXJ9IHRvIGRlc3Ryb3kgdGhlIGNyZWF0ZWQgSG9zdCBWaWV3LlxuICAgKi9cbiAgYWJzdHJhY3QgY3JlYXRlSG9zdFZpZXdJbkNvbnRhaW5lcihcbiAgICAgIHZpZXdDb250YWluZXJMb2NhdGlvbjogRWxlbWVudFJlZiwgaW5kZXg6IG51bWJlciwgaG9zdFZpZXdGYWN0b3J5UmVmOiBIb3N0Vmlld0ZhY3RvcnlSZWYsXG4gICAgICBkeW5hbWljYWxseUNyZWF0ZWRQcm92aWRlcnM6IFJlc29sdmVkUHJvdmlkZXJbXSwgcHJvamVjdGFibGVOb2RlczogYW55W11bXSk6IEhvc3RWaWV3UmVmO1xuXG4gIC8qKlxuICAgKiBEZXN0cm95cyBhbiBFbWJlZGRlZCBvciBIb3N0IFZpZXcgYXR0YWNoZWQgdG8gYSBWaWV3IENvbnRhaW5lciBhdCB0aGUgc3BlY2lmaWVkIGBpbmRleGAuXG4gICAqXG4gICAqIFRoZSBWaWV3IENvbnRhaW5lciBpcyBsb2NhdGVkIHZpYSBgdmlld0NvbnRhaW5lckxvY2F0aW9uYC5cbiAgICovXG4gIGFic3RyYWN0IGRlc3Ryb3lWaWV3SW5Db250YWluZXIodmlld0NvbnRhaW5lckxvY2F0aW9uOiBFbGVtZW50UmVmLCBpbmRleDogbnVtYmVyKTtcblxuICAvKipcbiAgICpcbiAgICogU2VlIHtAbGluayBBcHBWaWV3TWFuYWdlciNkZXRhY2hWaWV3SW5Db250YWluZXJ9LlxuICAgKi9cbiAgLy8gVE9ETyhpKTogcmVmYWN0b3IgZGV0YWNoVmlld0luQ29udGFpbmVyK2F0dGFjaFZpZXdJbkNvbnRhaW5lciB0byBtb3ZlVmlld0luQ29udGFpbmVyXG4gIGFic3RyYWN0IGF0dGFjaFZpZXdJbkNvbnRhaW5lcih2aWV3Q29udGFpbmVyTG9jYXRpb246IEVsZW1lbnRSZWYsIGluZGV4OiBudW1iZXIsXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB2aWV3UmVmOiBFbWJlZGRlZFZpZXdSZWYpOiBFbWJlZGRlZFZpZXdSZWY7XG5cbiAgLyoqXG4gICAqIFNlZSB7QGxpbmsgQXBwVmlld01hbmFnZXIjYXR0YWNoVmlld0luQ29udGFpbmVyfS5cbiAgICovXG4gIGFic3RyYWN0IGRldGFjaFZpZXdJbkNvbnRhaW5lcih2aWV3Q29udGFpbmVyTG9jYXRpb246IEVsZW1lbnRSZWYsIGluZGV4OiBudW1iZXIpOiBFbWJlZGRlZFZpZXdSZWY7XG59XG5cbkBJbmplY3RhYmxlKClcbmV4cG9ydCBjbGFzcyBBcHBWaWV3TWFuYWdlcl8gZXh0ZW5kcyBBcHBWaWV3TWFuYWdlciB7XG4gIHByaXZhdGUgX25leHRDb21wVHlwZUlkOiBudW1iZXIgPSAwO1xuXG4gIGNvbnN0cnVjdG9yKHByaXZhdGUgX3JlbmRlcmVyOiBSb290UmVuZGVyZXIsIHByaXZhdGUgX3ZpZXdMaXN0ZW5lcjogQXBwVmlld0xpc3RlbmVyLFxuICAgICAgICAgICAgICBASW5qZWN0KEFQUF9JRCkgcHJpdmF0ZSBfYXBwSWQ6IHN0cmluZykge1xuICAgIHN1cGVyKCk7XG4gIH1cblxuICBnZXRWaWV3Q29udGFpbmVyKGxvY2F0aW9uOiBFbGVtZW50UmVmXyk6IFZpZXdDb250YWluZXJSZWYge1xuICAgIHJldHVybiBsb2NhdGlvbi5pbnRlcm5hbEVsZW1lbnQuZ2V0Vmlld0NvbnRhaW5lclJlZigpO1xuICB9XG5cbiAgZ2V0SG9zdEVsZW1lbnQoaG9zdFZpZXdSZWY6IFZpZXdSZWZfKTogRWxlbWVudFJlZiB7XG4gICAgdmFyIGhvc3RWaWV3ID0gaG9zdFZpZXdSZWYuaW50ZXJuYWxWaWV3O1xuICAgIGlmIChob3N0Vmlldy5wcm90by50eXBlICE9PSBWaWV3VHlwZS5IT1NUKSB7XG4gICAgICB0aHJvdyBuZXcgQmFzZUV4Y2VwdGlvbignVGhpcyBvcGVyYXRpb24gaXMgb25seSBhbGxvd2VkIG9uIGhvc3Qgdmlld3MnKTtcbiAgICB9XG4gICAgcmV0dXJuIGhvc3RWaWV3LmFwcEVsZW1lbnRzWzBdLnJlZjtcbiAgfVxuXG4gIGdldE5hbWVkRWxlbWVudEluQ29tcG9uZW50Vmlldyhob3N0TG9jYXRpb246IEVsZW1lbnRSZWZfLCB2YXJpYWJsZU5hbWU6IHN0cmluZyk6IEVsZW1lbnRSZWYge1xuICAgIHZhciBhcHBFbCA9IGhvc3RMb2NhdGlvbi5pbnRlcm5hbEVsZW1lbnQ7XG4gICAgdmFyIGNvbXBvbmVudFZpZXcgPSBhcHBFbC5jb21wb25lbnRWaWV3O1xuICAgIGlmIChpc0JsYW5rKGNvbXBvbmVudFZpZXcpKSB7XG4gICAgICB0aHJvdyBuZXcgQmFzZUV4Y2VwdGlvbihgVGhlcmUgaXMgbm8gY29tcG9uZW50IGRpcmVjdGl2ZSBhdCBlbGVtZW50ICR7aG9zdExvY2F0aW9ufWApO1xuICAgIH1cbiAgICBmb3IgKHZhciBpID0gMDsgaSA8IGNvbXBvbmVudFZpZXcuYXBwRWxlbWVudHMubGVuZ3RoOyBpKyspIHtcbiAgICAgIHZhciBjb21wQXBwRWwgPSBjb21wb25lbnRWaWV3LmFwcEVsZW1lbnRzW2ldO1xuICAgICAgaWYgKFN0cmluZ01hcFdyYXBwZXIuY29udGFpbnMoY29tcEFwcEVsLnByb3RvLmRpcmVjdGl2ZVZhcmlhYmxlQmluZGluZ3MsIHZhcmlhYmxlTmFtZSkpIHtcbiAgICAgICAgcmV0dXJuIGNvbXBBcHBFbC5yZWY7XG4gICAgICB9XG4gICAgfVxuICAgIHRocm93IG5ldyBCYXNlRXhjZXB0aW9uKGBDb3VsZCBub3QgZmluZCB2YXJpYWJsZSAke3ZhcmlhYmxlTmFtZX1gKTtcbiAgfVxuXG4gIGdldENvbXBvbmVudChob3N0TG9jYXRpb246IEVsZW1lbnRSZWZfKTogYW55IHtcbiAgICByZXR1cm4gaG9zdExvY2F0aW9uLmludGVybmFsRWxlbWVudC5nZXRDb21wb25lbnQoKTtcbiAgfVxuXG4gIC8qKiBAaW50ZXJuYWwgKi9cbiAgX2NyZWF0ZVJvb3RIb3N0Vmlld1Njb3BlOiBXdGZTY29wZUZuID0gd3RmQ3JlYXRlU2NvcGUoJ0FwcFZpZXdNYW5hZ2VyI2NyZWF0ZVJvb3RIb3N0VmlldygpJyk7XG5cbiAgY3JlYXRlUm9vdEhvc3RWaWV3KGhvc3RWaWV3RmFjdG9yeVJlZjogSG9zdFZpZXdGYWN0b3J5UmVmXywgb3ZlcnJpZGVTZWxlY3Rvcjogc3RyaW5nLFxuICAgICAgICAgICAgICAgICAgICAgaW5qZWN0b3I6IEluamVjdG9yLCBwcm9qZWN0YWJsZU5vZGVzOiBhbnlbXVtdID0gbnVsbCk6IEhvc3RWaWV3UmVmIHtcbiAgICB2YXIgcyA9IHRoaXMuX2NyZWF0ZVJvb3RIb3N0Vmlld1Njb3BlKCk7XG4gICAgdmFyIGhvc3RWaWV3RmFjdG9yeSA9IGhvc3RWaWV3RmFjdG9yeVJlZi5pbnRlcm5hbEhvc3RWaWV3RmFjdG9yeTtcbiAgICB2YXIgc2VsZWN0b3IgPSBpc1ByZXNlbnQob3ZlcnJpZGVTZWxlY3RvcikgPyBvdmVycmlkZVNlbGVjdG9yIDogaG9zdFZpZXdGYWN0b3J5LnNlbGVjdG9yO1xuICAgIHZhciB2aWV3ID0gaG9zdFZpZXdGYWN0b3J5LnZpZXdGYWN0b3J5KHRoaXMuX3JlbmRlcmVyLCB0aGlzLCBudWxsLCBwcm9qZWN0YWJsZU5vZGVzLCBzZWxlY3RvcixcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBudWxsLCBpbmplY3Rvcik7XG4gICAgcmV0dXJuIHd0ZkxlYXZlKHMsIHZpZXcucmVmKTtcbiAgfVxuXG4gIC8qKiBAaW50ZXJuYWwgKi9cbiAgX2Rlc3Ryb3lSb290SG9zdFZpZXdTY29wZTogV3RmU2NvcGVGbiA9IHd0ZkNyZWF0ZVNjb3BlKCdBcHBWaWV3TWFuYWdlciNkZXN0cm95Um9vdEhvc3RWaWV3KCknKTtcblxuICBkZXN0cm95Um9vdEhvc3RWaWV3KGhvc3RWaWV3UmVmOiBWaWV3UmVmXykge1xuICAgIHZhciBzID0gdGhpcy5fZGVzdHJveVJvb3RIb3N0Vmlld1Njb3BlKCk7XG4gICAgdmFyIGhvc3RWaWV3ID0gaG9zdFZpZXdSZWYuaW50ZXJuYWxWaWV3O1xuICAgIGhvc3RWaWV3LnJlbmRlcmVyLmRldGFjaFZpZXcoZmxhdHRlbk5lc3RlZFZpZXdSZW5kZXJOb2Rlcyhob3N0Vmlldy5yb290Tm9kZXNPckFwcEVsZW1lbnRzKSk7XG4gICAgaG9zdFZpZXcuZGVzdHJveSgpO1xuICAgIHd0ZkxlYXZlKHMpO1xuICB9XG5cbiAgLyoqIEBpbnRlcm5hbCAqL1xuICBfY3JlYXRlRW1iZWRkZWRWaWV3SW5Db250YWluZXJTY29wZTogV3RmU2NvcGVGbiA9XG4gICAgICB3dGZDcmVhdGVTY29wZSgnQXBwVmlld01hbmFnZXIjY3JlYXRlRW1iZWRkZWRWaWV3SW5Db250YWluZXIoKScpO1xuXG4gIGNyZWF0ZUVtYmVkZGVkVmlld0luQ29udGFpbmVyKHZpZXdDb250YWluZXJMb2NhdGlvbjogRWxlbWVudFJlZl8sIGluZGV4OiBudW1iZXIsXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHRlbXBsYXRlUmVmOiBUZW1wbGF0ZVJlZl8pOiBFbWJlZGRlZFZpZXdSZWYge1xuICAgIHZhciBzID0gdGhpcy5fY3JlYXRlRW1iZWRkZWRWaWV3SW5Db250YWluZXJTY29wZSgpO1xuICAgIHZhciBjb250ZXh0RWwgPSB0ZW1wbGF0ZVJlZi5lbGVtZW50UmVmLmludGVybmFsRWxlbWVudDtcbiAgICB2YXIgdmlldzogQXBwVmlldyA9XG4gICAgICAgIGNvbnRleHRFbC5lbWJlZGRlZFZpZXdGYWN0b3J5KGNvbnRleHRFbC5wYXJlbnRWaWV3LnJlbmRlcmVyLCB0aGlzLCBjb250ZXh0RWwsXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGNvbnRleHRFbC5wYXJlbnRWaWV3LnByb2plY3RhYmxlTm9kZXMsIG51bGwsIG51bGwsIG51bGwpO1xuICAgIHRoaXMuX2F0dGFjaFZpZXdUb0NvbnRhaW5lcih2aWV3LCB2aWV3Q29udGFpbmVyTG9jYXRpb24uaW50ZXJuYWxFbGVtZW50LCBpbmRleCk7XG4gICAgcmV0dXJuIHd0ZkxlYXZlKHMsIHZpZXcucmVmKTtcbiAgfVxuXG4gIC8qKiBAaW50ZXJuYWwgKi9cbiAgX2NyZWF0ZUhvc3RWaWV3SW5Db250YWluZXJTY29wZTogV3RmU2NvcGVGbiA9XG4gICAgICB3dGZDcmVhdGVTY29wZSgnQXBwVmlld01hbmFnZXIjY3JlYXRlSG9zdFZpZXdJbkNvbnRhaW5lcigpJyk7XG5cbiAgY3JlYXRlSG9zdFZpZXdJbkNvbnRhaW5lcih2aWV3Q29udGFpbmVyTG9jYXRpb246IEVsZW1lbnRSZWZfLCBpbmRleDogbnVtYmVyLFxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIGhvc3RWaWV3RmFjdG9yeVJlZjogSG9zdFZpZXdGYWN0b3J5UmVmXyxcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBkeW5hbWljYWxseUNyZWF0ZWRQcm92aWRlcnM6IFJlc29sdmVkUHJvdmlkZXJbXSxcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBwcm9qZWN0YWJsZU5vZGVzOiBhbnlbXVtdKTogSG9zdFZpZXdSZWYge1xuICAgIHZhciBzID0gdGhpcy5fY3JlYXRlSG9zdFZpZXdJbkNvbnRhaW5lclNjb3BlKCk7XG4gICAgLy8gVE9ETyh0Ym9zY2gpOiBUaGlzIHNob3VsZCBiZSBzcGVjaWZpYWJsZSB2aWEgYW4gYWRkaXRpb25hbCBhcmd1bWVudCFcbiAgICB2YXIgY29udGV4dEVsID0gdmlld0NvbnRhaW5lckxvY2F0aW9uLmludGVybmFsRWxlbWVudDtcbiAgICB2YXIgaG9zdFZpZXdGYWN0b3J5ID0gaG9zdFZpZXdGYWN0b3J5UmVmLmludGVybmFsSG9zdFZpZXdGYWN0b3J5O1xuICAgIHZhciB2aWV3ID0gaG9zdFZpZXdGYWN0b3J5LnZpZXdGYWN0b3J5KFxuICAgICAgICBjb250ZXh0RWwucGFyZW50Vmlldy5yZW5kZXJlciwgY29udGV4dEVsLnBhcmVudFZpZXcudmlld01hbmFnZXIsIGNvbnRleHRFbCxcbiAgICAgICAgcHJvamVjdGFibGVOb2RlcywgbnVsbCwgZHluYW1pY2FsbHlDcmVhdGVkUHJvdmlkZXJzLCBudWxsKTtcbiAgICB0aGlzLl9hdHRhY2hWaWV3VG9Db250YWluZXIodmlldywgdmlld0NvbnRhaW5lckxvY2F0aW9uLmludGVybmFsRWxlbWVudCwgaW5kZXgpO1xuICAgIHJldHVybiB3dGZMZWF2ZShzLCB2aWV3LnJlZik7XG4gIH1cblxuICAvKiogQGludGVybmFsICovXG4gIF9kZXN0cm95Vmlld0luQ29udGFpbmVyU2NvcGUgPSB3dGZDcmVhdGVTY29wZSgnQXBwVmlld01hbmFuZ2VyI2Rlc3Ryb3lWaWV3SW5Db250YWluZXIoKScpO1xuXG4gIGRlc3Ryb3lWaWV3SW5Db250YWluZXIodmlld0NvbnRhaW5lckxvY2F0aW9uOiBFbGVtZW50UmVmXywgaW5kZXg6IG51bWJlcikge1xuICAgIHZhciBzID0gdGhpcy5fZGVzdHJveVZpZXdJbkNvbnRhaW5lclNjb3BlKCk7XG4gICAgdmFyIHZpZXcgPSB0aGlzLl9kZXRhY2hWaWV3SW5Db250YWluZXIodmlld0NvbnRhaW5lckxvY2F0aW9uLmludGVybmFsRWxlbWVudCwgaW5kZXgpO1xuICAgIHZpZXcuZGVzdHJveSgpO1xuICAgIHd0ZkxlYXZlKHMpO1xuICB9XG5cbiAgLyoqIEBpbnRlcm5hbCAqL1xuICBfYXR0YWNoVmlld0luQ29udGFpbmVyU2NvcGUgPSB3dGZDcmVhdGVTY29wZSgnQXBwVmlld01hbmFuZ2VyI2F0dGFjaFZpZXdJbkNvbnRhaW5lcigpJyk7XG5cbiAgLy8gVE9ETyhpKTogcmVmYWN0b3IgZGV0YWNoVmlld0luQ29udGFpbmVyK2F0dGFjaFZpZXdJbkNvbnRhaW5lciB0byBtb3ZlVmlld0luQ29udGFpbmVyXG4gIGF0dGFjaFZpZXdJbkNvbnRhaW5lcih2aWV3Q29udGFpbmVyTG9jYXRpb246IEVsZW1lbnRSZWZfLCBpbmRleDogbnVtYmVyLFxuICAgICAgICAgICAgICAgICAgICAgICAgdmlld1JlZjogVmlld1JlZl8pOiBFbWJlZGRlZFZpZXdSZWYge1xuICAgIHZhciBzID0gdGhpcy5fYXR0YWNoVmlld0luQ29udGFpbmVyU2NvcGUoKTtcbiAgICB0aGlzLl9hdHRhY2hWaWV3VG9Db250YWluZXIodmlld1JlZi5pbnRlcm5hbFZpZXcsIHZpZXdDb250YWluZXJMb2NhdGlvbi5pbnRlcm5hbEVsZW1lbnQsIGluZGV4KTtcbiAgICByZXR1cm4gd3RmTGVhdmUocywgdmlld1JlZik7XG4gIH1cblxuICAvKiogQGludGVybmFsICovXG4gIF9kZXRhY2hWaWV3SW5Db250YWluZXJTY29wZSA9IHd0ZkNyZWF0ZVNjb3BlKCdBcHBWaWV3TWFuYW5nZXIjZGV0YWNoVmlld0luQ29udGFpbmVyKCknKTtcblxuICAvLyBUT0RPKGkpOiByZWZhY3RvciBkZXRhY2hWaWV3SW5Db250YWluZXIrYXR0YWNoVmlld0luQ29udGFpbmVyIHRvIG1vdmVWaWV3SW5Db250YWluZXJcbiAgZGV0YWNoVmlld0luQ29udGFpbmVyKHZpZXdDb250YWluZXJMb2NhdGlvbjogRWxlbWVudFJlZl8sIGluZGV4OiBudW1iZXIpOiBFbWJlZGRlZFZpZXdSZWYge1xuICAgIHZhciBzID0gdGhpcy5fZGV0YWNoVmlld0luQ29udGFpbmVyU2NvcGUoKTtcbiAgICB2YXIgdmlldyA9IHRoaXMuX2RldGFjaFZpZXdJbkNvbnRhaW5lcih2aWV3Q29udGFpbmVyTG9jYXRpb24uaW50ZXJuYWxFbGVtZW50LCBpbmRleCk7XG4gICAgcmV0dXJuIHd0ZkxlYXZlKHMsIHZpZXcucmVmKTtcbiAgfVxuXG4gIC8qKiBAaW50ZXJuYWwgKi9cbiAgb25WaWV3Q3JlYXRlZCh2aWV3OiBBcHBWaWV3KSB7IHRoaXMuX3ZpZXdMaXN0ZW5lci5vblZpZXdDcmVhdGVkKHZpZXcpOyB9XG5cbiAgLyoqIEBpbnRlcm5hbCAqL1xuICBvblZpZXdEZXN0cm95ZWQodmlldzogQXBwVmlldykgeyB0aGlzLl92aWV3TGlzdGVuZXIub25WaWV3RGVzdHJveWVkKHZpZXcpOyB9XG5cbiAgLyoqIEBpbnRlcm5hbCAqL1xuICBjcmVhdGVSZW5kZXJDb21wb25lbnRUeXBlKGVuY2Fwc3VsYXRpb246IFZpZXdFbmNhcHN1bGF0aW9uLFxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIHN0eWxlczogQXJyYXk8c3RyaW5nIHwgYW55W10+KTogUmVuZGVyQ29tcG9uZW50VHlwZSB7XG4gICAgcmV0dXJuIG5ldyBSZW5kZXJDb21wb25lbnRUeXBlKGAke3RoaXMuX2FwcElkfS0ke3RoaXMuX25leHRDb21wVHlwZUlkKyt9YCwgZW5jYXBzdWxhdGlvbixcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgc3R5bGVzKTtcbiAgfVxuXG4gIHByaXZhdGUgX2F0dGFjaFZpZXdUb0NvbnRhaW5lcih2aWV3OiBBcHBWaWV3LCB2Y0FwcEVsZW1lbnQ6IEFwcEVsZW1lbnQsIHZpZXdJbmRleDogbnVtYmVyKSB7XG4gICAgaWYgKHZpZXcucHJvdG8udHlwZSA9PT0gVmlld1R5cGUuQ09NUE9ORU5UKSB7XG4gICAgICB0aHJvdyBuZXcgQmFzZUV4Y2VwdGlvbihgQ29tcG9uZW50IHZpZXdzIGNhbid0IGJlIG1vdmVkIWApO1xuICAgIH1cbiAgICB2YXIgbmVzdGVkVmlld3MgPSB2Y0FwcEVsZW1lbnQubmVzdGVkVmlld3M7XG4gICAgaWYgKG5lc3RlZFZpZXdzID09IG51bGwpIHtcbiAgICAgIG5lc3RlZFZpZXdzID0gW107XG4gICAgICB2Y0FwcEVsZW1lbnQubmVzdGVkVmlld3MgPSBuZXN0ZWRWaWV3cztcbiAgICB9XG4gICAgTGlzdFdyYXBwZXIuaW5zZXJ0KG5lc3RlZFZpZXdzLCB2aWV3SW5kZXgsIHZpZXcpO1xuICAgIHZhciByZWZOb2RlO1xuICAgIGlmICh2aWV3SW5kZXggPiAwKSB7XG4gICAgICB2YXIgcHJldlZpZXcgPSBuZXN0ZWRWaWV3c1t2aWV3SW5kZXggLSAxXTtcbiAgICAgIHJlZk5vZGUgPSBwcmV2Vmlldy5yb290Tm9kZXNPckFwcEVsZW1lbnRzLmxlbmd0aCA+IDAgP1xuICAgICAgICAgICAgICAgICAgICBwcmV2Vmlldy5yb290Tm9kZXNPckFwcEVsZW1lbnRzW3ByZXZWaWV3LnJvb3ROb2Rlc09yQXBwRWxlbWVudHMubGVuZ3RoIC0gMV0gOlxuICAgICAgICAgICAgICAgICAgICBudWxsO1xuICAgIH0gZWxzZSB7XG4gICAgICByZWZOb2RlID0gdmNBcHBFbGVtZW50Lm5hdGl2ZUVsZW1lbnQ7XG4gICAgfVxuICAgIGlmIChpc1ByZXNlbnQocmVmTm9kZSkpIHtcbiAgICAgIHZhciByZWZSZW5kZXJOb2RlO1xuICAgICAgaWYgKHJlZk5vZGUgaW5zdGFuY2VvZiBBcHBFbGVtZW50KSB7XG4gICAgICAgIHJlZlJlbmRlck5vZGUgPSAoPEFwcEVsZW1lbnQ+cmVmTm9kZSkubmF0aXZlRWxlbWVudDtcbiAgICAgIH0gZWxzZSB7XG4gICAgICAgIHJlZlJlbmRlck5vZGUgPSByZWZOb2RlO1xuICAgICAgfVxuICAgICAgdmlldy5yZW5kZXJlci5hdHRhY2hWaWV3QWZ0ZXIocmVmUmVuZGVyTm9kZSxcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGZsYXR0ZW5OZXN0ZWRWaWV3UmVuZGVyTm9kZXModmlldy5yb290Tm9kZXNPckFwcEVsZW1lbnRzKSk7XG4gICAgfVxuICAgIC8vIFRPRE86IFRoaXMgaXMgb25seSBuZWVkZWQgd2hlbiBhIHZpZXcgaXMgZGVzdHJveWVkLFxuICAgIC8vIG5vdCB3aGVuIGl0IGlzIGRldGFjaGVkIGZvciByZW9yZGVyaW5nIHdpdGggbmctZm9yLi4uXG4gICAgdmNBcHBFbGVtZW50LnBhcmVudFZpZXcuY2hhbmdlRGV0ZWN0b3IuYWRkQ29udGVudENoaWxkKHZpZXcuY2hhbmdlRGV0ZWN0b3IpO1xuICAgIHZjQXBwRWxlbWVudC50cmF2ZXJzZUFuZFNldFF1ZXJpZXNBc0RpcnR5KCk7XG4gIH1cblxuICBwcml2YXRlIF9kZXRhY2hWaWV3SW5Db250YWluZXIodmNBcHBFbGVtZW50OiBBcHBFbGVtZW50LCB2aWV3SW5kZXg6IG51bWJlcik6IEFwcFZpZXcge1xuICAgIHZhciB2aWV3ID0gTGlzdFdyYXBwZXIucmVtb3ZlQXQodmNBcHBFbGVtZW50Lm5lc3RlZFZpZXdzLCB2aWV3SW5kZXgpO1xuICAgIGlmICh2aWV3LnByb3RvLnR5cGUgPT09IFZpZXdUeXBlLkNPTVBPTkVOVCkge1xuICAgICAgdGhyb3cgbmV3IEJhc2VFeGNlcHRpb24oYENvbXBvbmVudCB2aWV3cyBjYW4ndCBiZSBtb3ZlZCFgKTtcbiAgICB9XG4gICAgdmNBcHBFbGVtZW50LnRyYXZlcnNlQW5kU2V0UXVlcmllc0FzRGlydHkoKTtcblxuICAgIHZpZXcucmVuZGVyZXIuZGV0YWNoVmlldyhmbGF0dGVuTmVzdGVkVmlld1JlbmRlck5vZGVzKHZpZXcucm9vdE5vZGVzT3JBcHBFbGVtZW50cykpO1xuXG4gICAgLy8gVE9ETzogVGhpcyBpcyBvbmx5IG5lZWRlZCB3aGVuIGEgdmlldyBpcyBkZXN0cm95ZWQsXG4gICAgLy8gbm90IHdoZW4gaXQgaXMgZGV0YWNoZWQgZm9yIHJlb3JkZXJpbmcgd2l0aCBuZy1mb3IuLi5cbiAgICB2aWV3LmNoYW5nZURldGVjdG9yLnJlbW92ZSgpO1xuICAgIHJldHVybiB2aWV3O1xuICB9XG59XG4iXX0=